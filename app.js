var dataObject = { 
	"272822514" : { 
	  "firstName": "Billy",
	  "lastName": "Bob",
	  "gender": "male",
	  "dob": "1/18/1949",
	  "height": 71,
	  "weight": 175,
	  "eyeColor": "brown",
	  "occupation": "programmer",
	  "parents": [],
	  "currentSpouse": 401222887 
	},
	"401222887" : { 
	  "firstName": "Uma",
	  "lastName": "Bob",
	  "gender": "female",
	  "dob": "4/1/1947",
	  "height": 65,
	  "weight": 162,
	  "eyeColor": "brown",
	  "occupation": "assistant",
	  "parents": [],
	  "currentSpouse": 272822514 
	},
	"409574486" : { 
	  "firstName": "Michael",
	  "lastName": "Walkens",
	  "gender": "male",
	  "dob": "5/9/1951",
	  "height": 76,
	  "weight": 250,
	  "eyeColor": "brown",
	  "occupation": "landscaper",
	  "parents": [],
	  "currentSpouse": 260451248 
	},
	"260451248" : {
	  "firstName": "Jon",
	  "lastName": "Walkens",
	  "gender": "male",
	  "dob": "9/6/1945",
	  "height": 62,
	  "weight": 115,
	  "eyeColor": "brown",
	  "occupation": "assistant",
	  "parents": [],
	  "currentSpouse": 409574486 
	},
	"629807187" : {
	  "firstName": "Jack",
	  "lastName": "Pafoy",
	  "gender": "male",
	  "dob": "3/16/1938",
	  "height": 70,
	  "weight": 207,
	  "eyeColor": "black",
	  "occupation": "nurse",
	  "parents": [],
	  "currentSpouse": 464142841 
	},
	"464142841" : {
	  "firstName": "Jen",
	  "lastName": "Pafoy",
	  "gender": "female",
	  "dob": "4/10/1940",
	  "height": 72,
	  "weight": 256,
	  "eyeColor": "black",
	  "occupation": "student",
	  "parents": [],
	  "currentSpouse": 629807187 
	},
	"982411429" : {
	  "firstName": "Mister",
	  "lastName": "Potatoo",
	  "gender": "male",
	  "dob": "12/18/1952",
	  "height": 66,
	  "weight": 170,
	  "eyeColor": "hazel",
	  "occupation": "architect",
	  "parents": [],
	  "currentSpouse": 595767575 
	},
	"595767575" : {
	  "firstName": "Missuz",
	  "lastName": "Potatoo",
	  "gender": "female",
	  "dob": "10/28/1948",
	  "height": 59,
	  "weight": 137,
	  "eyeColor": "blue",
	  "occupation": "architect",
	  "parents": [],
	  "currentSpouse": 982411429 
	},
	"693243224" : {
	  "firstName": "Joy",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "4/20/1939",
	  "height": 69,
	  "weight": 199,
	  "eyeColor": "hazel",
	  "occupation": "doctor",
	  "parents": [],
	  "currentSpouse": 693243224 
	},
	"888201200" : {
	  "firstName": "Mader",
	  "lastName": "Madden",
	  "gender": "male",
	  "dob": "5/6/1937",
	  "height": 76,
	  "weight": 205,
	  "eyeColor": "black",
	  "occupation": "landscaper",
	  "parents": [],
	  "currentSpouse": 888201200 
	},
	"878013758" : {
	  "firstName": "Jill",
	  "lastName": "Pafoy",
	  "gender": "Bob",
	  "dob": "2/8/1972",
	  "height": 74,
	  "weight": 118,
	  "eyeColor": "brown",
	  "occupation": "programmer",
	  "parents": [401222887,401222887],
	  "currentSpouse": 294874671 
	},
	"951747547" : {
	  "firstName": "Ralph",
	  "lastName": "Bob",
	  "gender": "male",
	  "dob": "12/23/1969",
	  "height": 66,
	  "weight": 179,
	  "eyeColor": "blue",
	  "occupation": "nurse",
	  "parents": [401222887,401222887],
	  "currentSpouse": 159819275 
	},
	"159819275" : {
	  "firstName": "Jasmine",
	  "lastName": "Bob",
	  "gender": "female",
	  "dob": "12/18/1969",
	  "height": 58,
	  "weight": 156,
	  "eyeColor": "blue",
	  "occupation": "assistant",
	  "parents": [409574486,260451248],
	  "currentSpouse": 951747547 
	},
	"348457184" : {
	  "firstName": "Annie",
	  "lastName": "Pafoy",
	  "gender": "female",
	  "dob": "11/4/1970",
	  "height": 62,
	  "weight": 235,
	  "eyeColor": "hazel",
	  "occupation": "landscaper",
	  "parents": [629807187,464142841],
	  "currentSpouse": null 
	},
	"294874671" : {
	  "firstName": "Dave",
	  "lastName": "Pafoy",
	  "gender": "male",
	  "dob": "8/5/1967",
	  "height": 61,
	  "weight": 112,
	  "eyeColor": "green",
	  "occupation": "doctor",
	  "parents": [629807187,464142841],
	  "currentSpouse": 878013758 
	},
	"931247228" : {
	  "firstName": "Amii",
	  "lastName": "Pafoy",
	  "gender": "female",
	  "dob": "3/13/1963",
	  "height": 74,
	  "weight": 184,
	  "eyeColor": "brown",
	  "occupation": "landscaper",
	  "parents": [629807187,464142841],
	  "currentSpouse": null 
	},
	"822843554" : {
	  "firstName": "Regina",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "7/26/1959",
	  "height": 71,
	  "weight": 249,
	  "eyeColor": "brown",
	  "occupation": "nurse",
	  "parents": [693243224, 888201200],
	  "currentSpouse": null 
	},
	"819168108" : {
	  "firstName": "Hana",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "10/7/1953",
	  "height": 70,
	  "weight": 187,
	  "eyeColor": "brown",
	  "occupation": "politician",
	  "parents": [693243224, 888201200],
	  "currentSpouse": null 
	},
	"969837479" : {
	  "firstName": "Eloise",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "12/11/1961",
	  "height": 63,
	  "weight": 241,
	  "eyeColor": "brown",
	  "occupation": "assistant",
	  "parents": [693243224, 888201200],
	  "currentSpouse": null 
	},
	"313207561" : {
	  "firstName": "Mattias",
	  "lastName": "Madden",
	  "gender": "male",
	  "dob": "2/19/1966",
	  "height": 70,
	  "weight": 110,
	  "eyeColor": "blue",
	  "occupation": "assistant",
	  "parents": [693243224, 888201200],
	  "currentSpouse": 313997561 
	},
	"313997561" : {
	  "firstName": "Ellen",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "2/19/1970",
	  "height": 67,
	  "weight": 100,
	  "eyeColor": "blue",
	  "occupation": "doctor",
	  "parents": [],
	  "currentSpouse": 313207561 
	},
	"313998000" : {
	  "firstName": "Joey",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "2/02/1987",
	  "height": 67,
	  "weight": 100,
	  "eyeColor": "blue",
	  "occupation": "doctor",
	  "parents": [313207561,313997561],
	  "currentSpouse": null 
	}
};

function initSearch(){
    alert("Welcome to the FBI's personal persons database");
	var fullArray = makeArray();
	getMenu(fullArray);
	
}
function promptRunDecision(){
	var decision = prompt("Would you like to continue? Type 'search' to continue searching or type 'exit' to close the program.");
	if (decision != null){
	switch (decision.toLowerCase().replace(/\s+/g, '')){
		case "search":
		initSearch();
		break;
		
		case "exit":
		window.close();
		break;		
		
		default :
		alert("Oops, we didn't understand that. Click Ok to try again." );
		promptRunDecision();
	}
	}
	else {
		alert("I'm sorry, you must enter a response.");
		promptRunDecision();
		}
	}
function getMenu(fullArray){
    var typeOfSearch = "filter"//prompt("What Type of Search would you like to run? A direct search by Name? (Type Name) or A filtered search by trait or combination of traits?(Type Filter)");
    if (typeOfSearch != null){
	switch (typeOfSearch.toLowerCase().replace(/\s+/g, '')){
        case "name":        
			personResult = getCorrectPerson(fullArray);
			displayNamesOnly(personResult);
			typeOfSecondaryDirectSearch(personResult, fullArray);
			
            break;
        case "filter":
			performSecondaryFilterSearch(fullArray);
            break;
        default:
			alert("Oops, did you type 'Name' or 'Filter'?. Click Ok to try again.");
			getMenu(fullArray);
            break;
            
    }
	}
	else {
		alert("I'm sorry, you must enter a response.");
		getMenu(fullArray);
		}
}

function getCorrectPerson(fullArray){
	var personResult = [];
	var firstName = prompt("What is the First Name of the individual you are searching for? (Name is Case Sensitive)");
    var lastName = prompt("What is the Last Name Of the Individual you are searching for? (Name is Case Sensitive)");
	firstName = firstName.replace(/\s+/g, '');
	lastName = lastName.replace(/\s+/g, '');
	
	if (firstName != null || lastName != null){
	
	if (checkIfNameExists(firstName, lastName, fullArray) == false){
	personResult = getPersonInfo(firstName, lastName, fullArray);	
	}
	else{
		alert("Oops, we couldn't find anyone by that name in our system. Click Ok to try again.");
		getCorrectPerson(fullArray);
	}
	}
		
	else {
		alert("I'm sorry, you must enter a response.");
		getCorrectPerson(fullArray);
		}
	return personResult;
}

function checkIfNameExists(firstName, lastName, fullArray){
	var trigger = false;
	var person = getPersonInfo(firstName, lastName, fullArray);
	if (person.length == 0){
		trigger = true;
	}
	return trigger;
	
}
function typeOfSecondaryDirectSearch(personInfoArray, fullArray){
	var secondarySearch = prompt("What do you want to find out about " + personInfoArray[0].firstName.toString() + "? (Type Bio, Descendents, Immediate Family, Next of Kin(Types are case-sensitive)");
    
	if (secondarySearch != null){
	switch (secondarySearch.toLowerCase().replace(/\s+/g, '')){
        case "bio":
			displayProfiles(personInfoArray);
		break;
		case "descendents":
			var descendents = [];
			descendents = getDescendents(personInfoArray, fullArray);
			displayNamesOnly(descendents);
		break;
		case "immediatefamily":
			var immediateFamily = getImmediateFamily(personInfoArray, fullArray);
			displayNamesOnly(immediateFamily);
		break;
		case "nextofkin":
			var nextOfKin = findNextOfKin(personInfoArray, fullArray);
			displayNamesOnly(nextOfKin);
		break;
		default:
			alert("Oops, we didn't understand that. Click Ok to try again." );
			typeOfSecondaryDirectSearch(personInfoArray);
		break;
	}
	}
	else {
		alert("I'm sorry, you must enter a response.");
		typeOfSecondaryDirectSearch(personInfoArray, fullArray);
		}
}
function performSecondaryFilterSearch(fullArray){
	var filterBy = prompt("What would you like to filter by?  Age, Age-Range, Height, Weight, Occupation, or EyeColor? (Select a max of 5 separated with a ,)")
	if (filterBy != null){
		filterBy = filterBy.replace(/\s+/g, '');
		var filterByArray = filterBy.split(',');
		var choices = evaluateFilterBy(filterByArray);
		var searchResult = searchByFilters(choices, fullArray);
		displayNamesOnly(searchResult);
		}
	else {
		alert("I'm sorry, you must enter a response.");
		performSecondaryFilterSearch(fullArray);
		}
			
}
function getPersonInfo(inputFirstName, inputLastName, fullArray){
	
	var result = fullArray.filter(checkName);
	return result;

	function checkName(object){
	return object.firstName == inputFirstName && object.lastName == inputLastName;
	
}
}

function evaluateFilterBy(filterByArray){
	
	for (var item in filterByArray){
		switch(filterByArray[item].toLowerCase()){
		case "age":
		break;
		
		case "age-range":
		break;
		
		case "height":
		break;
		
		case "weight":
		break;
		
		case "occupation":
		break;
		
		case "eyecolor":
		break;
		
		default : 		
		filterByArray[item] = prompt("Oops, something went wrong with the way you spelled " + filterByArray[item] + ". Please try again. Or leave blank and press Ok to remove." );
		if (filterByArray[item] == ""){
			filterByArray.splice(item, 1);		
		}
		evaluateFilterBy(filterByArray);
		break;
	}
	
	}
		return filterByArray;
	}
	
function findNextOfKin(personInfoArray, fullArray){
	var spouse = getSpouse(personInfoArray, fullArray);
	var nextOfKin = spouse;
	var children = [];
	var parents = [];
	var grandparents = [];
	var grandchildren = [];
	var niecesAndNephews = [];
	var auntsAndUncles = [];
	var greatGrandchildren = [];
	var greatGrandparents = [];

	
	if (nextOfKin.length == 0){
		children = getChildren(personInfoArray, fullArray);
		nextOfKin[0] = children[0];
	}
	else if (nextOfKin.length == 0){
		parents = getParents(personInfoArray, fullArray);
		nextOfKin[0] = parents[0];
	}
	else if (nextOfKin.length == 0){
		siblings = getSiblings(personInfoArray, fullArray);
		nextOfKin[0] = silbings[0];
	}
	else if (nextOfKin.length == 0){
		grandchildren = getChildren(children, fullArray);
		nextOfKin[0] = grandchildren[0];
	}
	else if (nextOfKin.length == 0){
		grandparents = getParent(parents, fullArray);
		nextOfKin[0] = grandparents[0];
	}	
	else if (nextOfKin.length == 0){
		niecesAndNephews = getChildren(siblings, fullArray);
		nextOfKin[0] = niecesAndNephews[0];
	}	
	else if (nextOfKin.length == 0){
		auntsAndUncles = getSiblings(parents, fullArray);
		nextOfKin[0] = auntsAndUncles[0];
	}
	else if (nextOfKin.length == 0){
		greatGrandchildren = getChildren(grandchildren, fullArray);
		nextOfKin[0] = greatGrandchildren[0];
	}
	else if (nextOfKin.length == 0){
		greatGrandparents = getParents(grandparents, fullArray);
		nextOfKin[0] = greatGrandparents[0];
	}	
	return nextOfKin;	
}


function searchByFilters(choicesArray, fullArray){
	
	var filteredArray = fullArray;
	
	for (var item in choicesArray){
	switch(choicesArray[item].toLowerCase()){
		case "age":
		var ageInput = prompt("Please specify age in numerical years.");
			filteredArray = getAgeFilteredArray(ageInput, filteredArray);
		break;
		
		case "age-range":
			var ageRangeInput = prompt("Please specify age-range in numerical years with a dash(x-y) where x is less than y.");
			filteredArray = getAgeRangeFilteredArray(ageRangeInput, filteredArray);
		break;
		
		case "height":
			var heightInput = prompt("Please specify the height in feet and inches, including punctuation with no spaces(x'y" + '"' + ").");
			var heightString = heightInput.replace('"');
			var heightArray = heightString.split("'");
			var heightInInches = heightArray[0]*12 + heightArray[1];
			filteredArray = getFiltered("height", heightInInches, filteredArray);
		break;
		
		case "weight":
			var weightInput = prompt("Please specify the weight in pounds using the abbreviation 'lbs' with no space or punctuation (xlbs).");
			filteredArray = getFiltered("weight", weightInput, filteredArray);
		break;
		
		case "occupation":
			var occupationInput = "doctor" //prompt("Please specify the occupation by typing a single word with no punctuation.");
			filteredArray = getFiltered("occupation", occupationInput, filteredArray);
		break;
		
		case "eyecolor":
			var eyeColorInput = prompt("Please specify the eye color by typing a single word with no punctuation.");
			filteredArray = getFiltered("eyeColor", eyeColorInput, filteredArray);
		break;
		
		default : 
			alert("Oops, we didn't understand that. Click Ok to try again." );		
		break;
}
}	

return filteredArray;
}



function getAgeRangeFilteredArray(criteria, fullArray){
	var ageRangeArray = criteria.split('-');
	var filteredArray = fullArray.filter(checkAgeRange);
	return filteredArray;
	
	function checkAgeRange(object){
		
		var age = calculateAge(object["dob"]);
		return age > ageRangeArray[0] && age < ageRangeArray[1];
	}
	
}

function getAgeFilteredArray(criteria, fullArray) {
	
	var filteredArray = fullArray.filter(checkAge);
	return filteredArray;
	
	
	
	function checkAge(object){
		
	var age = calculateAge(object["dob"]);
	
	return age == criteria;
	}
}

function getFiltered(property, criteria, fullArray){
	var result = fullArray.filter(checkForTrait)
	return result;
	function checkForTrait(object){
		return object[property] == criteria;
	}
	
	}
	
	
function getImmediateFamily(personInfoArray, fullArray){
	
	var immediateFamily = [];
	var children = getChildren(personInfoArray, fullArray);
	var siblings = getSiblings(personInfoArray, fullArray);
	var parents = getParents(personInfoArray, fullArray); 
	var spouse = getSpouse(personInfoArray, fullArray);
	var result = immediateFamily.concat(children, siblings, parents, spouse);
	
	return result;
	
	}
	
function getSpouse(personInfoArray, fullArray){
		var spouse = personInfoArray[0].currentSpouse;
		var result = fullArray.filter(checkIfSpouse);
		return result;
		
		function checkIfSpouse(object){
		return object.id == spouse ;
		}
		
}

	
function getChildren(personInfoArray, fullArray){
    var result = [];

	for (var item in personInfoArray){
	var id = personInfoArray[item].id;
    result = fullArray.filter(checkForParentage);
   return result;
    
    function checkForParentage(object){
        var parentOneId = object.parents[0];
        var parentTwoId = object.parents[1];
        return id == parentOneId || id == parentTwoId;
    }
    }
	 result = result.sort(function(a, b){
		return new Date(a.dob) - new Date(b.dob);
	})
	
	 return result;
}	

function getParents(personInfoArray, fullArray){
		var result = [];
		var allParents = [];
		
	for (var item in personInfoArray){
		
		var parentOneId = personInfoArray[item].parents[0];
		var parentTwoId = personInfoArray[item].parents[1];
		
		result = fullArray.filter(checkIfParents);
		allParents = allParents.concat(result);	
		
		function checkIfParents(object){
		return object.id == parentOneId || object.id == parentTwoId;
		}
	}
		 result = result.sort(function(a, b){
		return new Date(a.dob) - new Date(b.dob);
	})
		return allParents;
			
		}
		

		
function getDescendents(personInfoArray, fullArray, descendents = []){
	
	var generationOfChildren = getChildren(personInfoArray, fullArray);
		
		
if (generationOfChildren.length != 0){
		descendents = descendents.concat(generationOfChildren);
		getDescendents(generationOfChildren, fullArray, descendents);
	}
	return descendents;
	
}



function getSiblings(personInfoArray, fullArray){
		var result = [];
		var allSiblings = [];

		for (var item in personInfoArray){
			
		var id = personInfoArray[item].id;

		var parentOneId = personInfoArray[item].parents[0];
		var parentTwoId = personInfoArray[item].parents[1];
	
		result = fullArray.filter(checkForSiblings);
		allSiblings = allSiblings.concat(result);
		
		function checkForSiblings(object){	
		return parentOneId == object.parents[0] || parentTwoId == object.parents[1] && object.id != id;

		}	
}
		result = result.sort(function(a, b){
			return new Date(a.dob) - new Date(b.dob);
	})
	return allSiblings;
}

function displaySiblings(siblingsArray){
	
}
	
function getTraitsObjects(inputAge, inputEyeColor, inputOccupation, fullArray){
    
    var result = fullArray.filter(CheckTraits);
    return result;

    function checkTraits(object){
    return object.age == inputAge && object.Occupation == inputOccupation && object.eyeColor == inputEyeColor;
}
}

function calculateAge(dob){
	var dobValue = [];
	if (dob != null){
	dobValue = dob.split('/');
	born = new Date(dobValue[2]-1900, dobValue[0]-1, dobValue[1]);
	today = new Date();
	var age =  Math.floor((today.getTime() - born.getTime()) / (365.25 * 24 * 60 * 60 * 1000));
	
		return age;
	}
	
}

function displayNamesOnly(info){
	var listOfNames = "";
	info.forEach(function(object){
		listOfNames = listOfNames + object["firstName"] + " " + object["lastName"] + ", ";
	});
	
	if (listOfNames!=""){
		listOfNames = listOfNames.substring(0,listOfNames.length - 2);
		alert("Search yields " + listOfNames);
	}
	else{
		alert("I'm sorry but your search yielded no results, are you sure you entered in the correct criteria.");
	}
}
function displayProfiles(info){
	var listOfProfiles = "";
	info.forEach(function(object){	
		listOfProfiles = listOfProfiles + object["firstName"]  + " " +  object["lastName"] + " Age: " + calculateAge(object["dob"]) + " Gender: " +  object["gender"]  + " Height: " + object["height"] + " Weight: " +  object["weight"] + " Eye Color: " +  object["eyeColor"] + " Occupation: " +  object["occupation"] + ", ";
	}
	);
	
	if (listOfProfiles != ""){
		listOfProfiles = listOfProfiles.substring(0,listOfProfiles.length - 2);
		alert("Search yields " + listOfProfiles);
	}
	else{
		alert("I'm sorry but your search yielded no results, are you sure you entered in the correct criteria.");
	}	
}


function makeArray(){

var firstArray = [];


    Object.keys(dataObject).map(function(id, index){
	dataObject[id].id = id;
	firstArray[index]  = dataObject[id];
});

return firstArray;

}

initSearch();
promptRunDecision();